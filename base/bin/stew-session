#!/bin/bash

# Session management for Hyprland

set -e

# Session actions
lock_session() {
    hyprlock
}

logout_session() {
    hyprctl dispatch exit
}

sleep_session() {
    systemctl suspend
}

restart_session() {
    systemctl reboot
}

shutdown_session() {
    systemctl poweroff
}

# Main logic
case "${1:-pick}" in
    lock)
        lock_session
        ;;
    logout)
        logout_session
        ;;
    sleep)
        sleep_session
        ;;
    restart)
        restart_session
        ;;
    shutdown)
        shutdown_session
        ;;
    pick)
        command -v fuzzel >/dev/null || { echo "fuzzel not found" >&2; exit 1; }

        actions=("lock" "logout" "sleep" "restart" "shutdown")
        margin=10
        args="--dmenu --anchor=top-right --x-margin=${margin} --y-margin=${margin}"

        # Build fuzzel input
        for action in "${actions[@]}"; do
            echo "$action"
        done | fuzzel --prompt='Session: ' ${args} | {
            read -r selected || exit 0  # Exit silently if cancelled

            case "$selected" in
                lock) lock_session ;;
                logout) logout_session ;;
                sleep) sleep_session ;;
                restart) restart_session ;;
                shutdown) shutdown_session ;;
                *) echo "Invalid action: $selected" >&2; exit 1 ;;
            esac
        }
        ;;
    *)
        echo "Usage: $0 [lock|logout|sleep|restart|shutdown|pick]" >&2
        exit 1
        ;;
esac
